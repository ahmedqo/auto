function empty(){return"N/A"}function tabs(){let e=[...$qall("[data-tabs]")].reduce((e,t)=>({...e,[+t.dataset.tabs]:t}),{}),t=[...$qall("[data-view]")].reduce((e,t)=>({...e,[+t.dataset.view]:t}),{}),a=$query("#next"),n=$query("#save"),r=Object.values(e),l=Object.values(t);var i=1;function s(){i===r.length?(a.classList.add("hidden"),n.classList.remove("hidden")):(a.classList.remove("hidden"),n.classList.add("hidden"))}function o(e,a){if(a&&a<i)return e();let n=t[i].querySelectorAll("[require]"),r=[];n.forEach(e=>{String(e.value).trim()?e.classList.remove("outline","outline-2","-outline-offset-2","outline-red-400"):e.classList.add("outline","outline-2","-outline-offset-2","outline-red-400"),r.push(!!String(e.value).trim())}),r.includes(!1)||e()}Object.entries(e).forEach(([e,a])=>{a.addEventListener("click",n=>{o(()=>{r.forEach(e=>e.classList.remove("active")),l.forEach(e=>{e.classList.remove("grid"),e.classList.add("hidden")}),a.classList.add("active"),t[e].classList.add("grid"),t[e].classList.remove("hidden"),i=+e,s()},+e)})}),a.addEventListener("click",a=>{o(()=>{i+=1,r.forEach(e=>e.classList.remove("active")),l.forEach(e=>{e.classList.remove("grid"),e.classList.add("hidden")}),e[i].classList.add("active"),t[i].classList.add("grid"),t[i].classList.remove("hidden"),s()},i+1)})}function betweenDates(e,t){let a=new Date(e),n=new Date(t);return(n-a)/864e5}async function getData(e,t){let a=await fetch(e),n=await a.json();return t&&t(n.prev_cursor,n.next_cursor,new URL(e).searchParams.get("search")),n.data}function TableVisualizer(e,t,a){let n=document.createElement("div");async function r(t){t.preventDefault(),e.loading=!0,e.rows=await getData(t.target.href,l),e.loading=!1}function l(t,l,i){let s="?search"+(i?"="+i:""),o=$query("#prev"),c=$query("#next");if(t){let d=a.Search+s+"&cursor="+t;if(o)o.href=d;else{let v=n.querySelector("#prev").cloneNode(!0);v.addEventListener("click",r),c?e.insertBefore(v,c):e.insertAdjacentElement("afterstart",v),v.title=$trans("Prev"),v.href=d}}else o&&(o.removeEventListener("click",r),o.remove());if(l){let u=a.Search+s+"&cursor="+l;if(c)c.href=u;else{let _=n.querySelector("#next").cloneNode(!0);_.addEventListener("click",r),e.insertAdjacentElement("afterstart",_),_.title=$trans("Next"),_.href=u}}else c&&(c.removeEventListener("click",r),c.remove())}n.innerHTML='<a id="prev" slot="end" aria-label="prev_page_link" class="block w-6 h-6 text-x-black outline-none relative isolate before:content-[\'\'] before:rounded-x-thin before:absolute before:block before:w-[130%] before:h-[130%] before:-inset-[15%] before:-z-[1] before:!bg-opacity-40 hover:before:bg-x-shade focus:before:bg-x-shade focus-within:before:bg-x-shade"><svg class="block w-6 h-6 pointer-events-none" fill="currentcolor" viewBox="0 -960 960 960"><path d="M452-219 190-481l262-262 64 64-199 198 199 197-64 65Zm257 0L447-481l262-262 63 64-198 198 198 197-63 65Z" /></svg></a><a id="next" slot="end" aria-label="next_page_link" class="block w-6 h-6 text-x-black outline-none relative isolate before:content-[\'\'] before:rounded-x-thin before:absolute before:block before:w-[130%] before:h-[130%] before:-inset-[15%] before:-z-[1] before:!bg-opacity-40 hover:before:bg-x-shade focus:before:bg-x-shade focus-within:before:bg-x-shade"><svg class="block w-6 h-6 pointer-events-none" fill="currentcolor" viewBox="0 -960 960 960"><path d="M388-481 190-679l64-64 262 262-262 262-64-65 198-197Zm257 0L447-679l63-64 262 262-262 262-63-65 198-197Z" /></svg></a>',async function(){e.loading=!0,e.rows=await getData(a.Search+window.location.search,l),e.loading=!1}(),e.cols=COLS[t]({Currency:a.Currency,Scene:a.Scene,Print:a.Print,Patch:a.Patch,Clear:a.Clear,Csrf:a.Csrf});var i,s=a.Search;async function o(t){i&&clearTimeout(i),e.loading=!0,e.rows=await new Promise((e,a)=>{i=setTimeout(async()=>{let a=await getData(s+(t?"?search="+encodeURIComponent(t.detail.data):""),l);e(a)},2e3)}),e.loading=!1}var c=e.querySelector("#all");c&&c.addEventListener("change",e=>{s=e.target.active?a.Filter:a.Search,o()}),e.addEventListener("search",async e=>{e.preventDefault(),o(e)})}function VehicleInitializer(){let e=$query("neo-select[name=brand]"),t=$query("neo-select[name=model]"),a=$query("neo-select[name=fuel]"),n=$query("neo-select[name=horsepower]"),r=$query("#tax"),l={gasoline:{"less than 8 cv":300,"between 8 and 10 cv":650,"between 11 and 14 cv":3e3,"grather than or equals to 15 cv":8e3},diesel:{"less than 8 cv":700,"between 8 and 10 cv":1500,"between 11 and 14 cv":6e3,"grather than or equals to 15 cv":2e4}};function i(){if(!a.value||!n.value)return;let e=l[a.value];r.value=(e?e[n.value]:0)||0}a.addEventListener("change",i),n.addEventListener("change",i),e.addEventListener("change",e=>{t.disable=!1;let a="";Models[e.detail.data].forEach(e=>{a+=`<neo-select-item value="${e}">${$cap($trans(e))}</neo-select-item>`}),t.reset(),t.innerHTML=a}),tabs()}function AlertInitializer({Vehicle:e}){var t,a,n;let r=$query("neo-autocomplete[name=vehicle]"),l=$query("neo-select[name=unit]"),i=$query(".date"),s=i.querySelector("neo-datepicker[name=date]");l.addEventListener("change",e=>{"mileage"===e.detail.data?(i.classList.add("hidden"),i.classList.remove("flex"),s.removeAttribute("require"),s.reset()):(i.classList.remove("hidden"),i.classList.add("flex"),s.setAttribute("require",""))}),t=r,a=e,t.addEventListener("input",async e=>{n&&clearTimeout(n),t.loading=!0;let r=await new Promise((e,r)=>{n=setTimeout(async()=>{let n=await getData(a+"?search="+encodeURIComponent(t.query.trim()));t.loading=!1,e(n)},250)});r=r.map(e=>({...e,name:$cap(e.brand)+" "+$cap(e.model)+" "+e.year+" ("+$cap(e.registration)+")"})),t.data=r}),t.addEventListener("select",e=>{e.target.querySelector("input").value=e.detail.data[e.target.setQuery]})}function ReservationInitializer({Client:e,Vehicle:t,Mileage:a,Colors:n}){let r=$query("neo-autocomplete[name=client]"),l=$query("neo-autocomplete[name=secondary_client]"),i=$query("neo-autocomplete[name=vehicle]"),s=$query("neo-textbox[name=price]"),o=$query("neo-textbox[name=starting_mileage]"),c=$query("neo-textbox[name=return_mileage]"),d=$query("neo-textbox[name=total]"),v=$query("neo-datepicker[name=from_date]"),u=$query("neo-timepicker[name=from_time]"),_=$query("neo-datepicker[name=to_date]"),h=$query("neo-timepicker[name=to_time]"),$=$query("neo-textbox[name=payment]"),b=$query("neo-textbox[name=creance]"),m=$query("neo-overlay"),f=$query("#list"),p=$query("#cost"),g=$query("#json"),y=document.createElement("table"),x=JSON.parse(g.value);function E(e,t,a){var n;e.addEventListener("input",async r=>{n&&clearTimeout(n),e.loading=!0;var l=await new Promise((a,r)=>{n=setTimeout(async()=>{let n=await getData(t+"?search="+encodeURIComponent(e.query.trim()));e.loading=!1,a(n)},250)});"client"===a&&(l=l.map(e=>({...e,name:$cap(e.first_name)+" "+$cap(e.last_name)+(e.blacklist?" (blacklisted)":"")}))),"vehicle"===a&&(l=l.map(e=>({...e,name:$cap(e.brand)+" "+$cap(e.model)+" "+e.year+" ("+$cap(e.registration)+")"}))),e.data=l}),e.addEventListener("select",e=>{e.target.querySelector("input").value=e.detail.data[e.target.setQuery]})}function L(){let e=betweenDates(v.value+" "+u.value,_.value+" "+h.value),t=parseFloat(String(s.value).replace(/,/g,"")||0),a=x.reduce((e,t)=>e+t,0);d.value=$money(t*e,3),$.value=$money(a,3),b.value=$money(t*e-a,3)}function w(){let e=betweenDates(v.value+" "+u.value,_.value+" "+h.value),t=parseFloat(o.value||0);c.value=t+e*Mileage}function k(e){y.innerHTML=`<tr class="border-t border-t-x-shade"><td class="w-[200px] ps-8 px-4 py-2 text-lg text-x-black text-center">${$money(e,3)} ${Currency}</td><td></td><td class="w-[80px] pe-8 px-4 py-2 text-base text-x-black text-center"><button class="block mx-auto px-2 py-1 bg-red-500 rounded-x-thin text-x-white outline-none hover:bg-red-400 focus:bg-red-400"><svg class="w-[1.2rem] h-[1.2rem] pointer-events-none" fill="currentColor" viewBox="0 -960 960 960"><path d="M267-74q-55.73 0-95.86-39.44Q131-152.88 131-210v-501H68v-136h268v-66h287v66h269v136h-63v501q0 57.12-39.44 96.56Q750.13-74 693-74H267Zm67-205h113v-363H334v363Zm180 0h113v-363H514v363Z" /></svg></button></td></tr>`;let t=y.querySelector("tr");return t.querySelector("button").addEventListener("click",e=>{e.preventDefault(),x.splice([...f.children].indexOf(t),1),g.value=JSON.stringify(x),t.remove(),L()}),t}$.addEventListener("click",e=>{m.show()}),o.addEventListener("change",e=>{w()}),p.addEventListener("submit",e=>{e.preventDefault(),e.target.elements[0].value&&(x.push(parseFloat(e.target.elements[0].value)),f.insertAdjacentElement("beforeend",k(+e.target.elements[0].value)),e.target.elements[0].value="",g.value=JSON.stringify(x),L())}),i.addEventListener("select",async e=>{s.value=e.detail.data.price,L();let t=await getData(a.replace("XXX",e.detail.data.id));o.value=t.mileage||e.detail.data.mileage,w()}),[v,u,_,h,s].forEach(e=>{e.addEventListener("change",e=>{L(),w()})}),x.length&&x.forEach((e,t)=>{f.insertAdjacentElement("beforeend",k(+e))}),StateInitializer(n),E(l,e,"client"),E(i,t,"vehicle"),E(r,e,"client"),L(),tabs()}function paymentInitializer(){let e=$query("neo-textbox[name=total]"),t=$query("neo-textbox[name=payment]"),a=$query("neo-textbox[name=creance]"),n=$query("neo-overlay"),r=$query("#list"),l=$query("#cost"),i=$query("#json"),s=document.createElement("table"),o=JSON.parse(i.value);function c(){let n=parseFloat(e.value.replace(/,/g,"")),r=o.reduce((e,t)=>e+t,0);t.value=$money(r,3),a.value=$money(n-r,3)}function d(e){s.innerHTML=`<tr class="border-t border-t-x-shade"><td class="w-[200px] ps-8 px-4 py-2 text-lg text-x-black text-center">${$money(e,3)} ${Currency}</td><td></td><td class="w-[80px] pe-8 px-4 py-2 text-base text-x-black text-center"><button class="block mx-auto px-2 py-1 bg-red-500 rounded-x-thin text-x-white outline-none hover:bg-red-400 focus:bg-red-400"><svg class="w-[1.2rem] h-[1.2rem] pointer-events-none" fill="currentColor" viewBox="0 -960 960 960"><path d="M267-74q-55.73 0-95.86-39.44Q131-152.88 131-210v-501H68v-136h268v-66h287v66h269v136h-63v501q0 57.12-39.44 96.56Q750.13-74 693-74H267Zm67-205h113v-363H334v363Zm180 0h113v-363H514v363Z" /></svg></button></td></tr>`;let t=s.querySelector("tr");return t.querySelector("button").addEventListener("click",e=>{e.preventDefault(),o.splice([...r.children].indexOf(t),1),i.value=JSON.stringify(o),t.remove(),c()}),t}t.addEventListener("click",e=>{n.show()}),l.addEventListener("submit",e=>{e.preventDefault(),e.target.elements[0].value&&(o.push(parseFloat(e.target.elements[0].value)),r.insertAdjacentElement("beforeend",d(+e.target.elements[0].value)),e.target.elements[0].value="",i.value=JSON.stringify(o),c())}),o.length&&o.forEach((e,t)=>{r.insertAdjacentElement("beforeend",d(+e))}),c()}function ChargeInitializer({Search:e}){var t;let a=$query("neo-autocomplete");a.addEventListener("input",async n=>{t&&clearTimeout(t),a.loading=!0;let r=await new Promise((n,r)=>{t=setTimeout(async()=>{let t=await getData(e+"?search="+encodeURIComponent(a.query.trim()));a.loading=!1,n(t)},250)});a.data=r.map(e=>({...e,name:$cap(e.brand)+" "+$cap(e.model)+" "+e.year+" ("+$cap(e.registration)+")"})),a.addEventListener("select",e=>{e.target.querySelector("input").value=e.detail.data[e.target.setQuery]})})}function BlackListInitializer({Search:e}){var t;let a=$query("neo-autocomplete");a.addEventListener("input",async n=>{t&&clearTimeout(t),a.loading=!0;let r=await new Promise((n,r)=>{t=setTimeout(async()=>{let t=await getData(e+"?search="+encodeURIComponent(a.query.trim()));a.loading=!1,n(t)},250)});a.data=r.map(e=>({...e,name:$cap(e.first_name)+" "+$cap(e.last_name)+(e.blacklist?" (blacklisted)":"")})),a.addEventListener("select",e=>{e.target.querySelector("input").value=e.detail.data[e.target.setQuery]})})}async function CoreInitializer({Table:e,Pie:t,Line:a,Search:n,Data:r,Total:l,Charges:i}){TableVisualizer(e,"most",{Search:n}),new Chart(t,{type:"doughnut",data:{labels:[$trans("Total"),$trans("Charges")],datasets:[{data:[l,i],borderWidth:1,backgroundColor:["#22C55E","#EC4899"],borderColor:["#22C55E","#EC4899"]},]},options:{responsive:!0,cutout:"80%",plugins:{legend:{display:!1}}}});let s=await getData(r);function o(){t.style.width="100%",t.style.height="100%",a.style.width="100%",a.style.height="100%"}s.keys=s.keys.map(e=>$trans(e)),new Chart(line,{type:"bar",data:{labels:s.keys,datasets:[{data:s.payments,order:2,borderWidth:2,backgroundColor:"#22C55E",borderColor:"#22C55E",label:$trans("Payments")},{data:s.creances,order:2,borderWidth:2,backgroundColor:"#EAB308",borderColor:"#EAB308",label:$trans("Creances")},{data:s.charges,borderWidth:2,backgroundColor:"#EC4899",borderColor:"#EC4899",label:$trans("Charges")},]},options:{responsive:!0,plugins:{legend:{labels:{fontColor:"#1D1D1D",fontSize:18}}}}}),line.parentElement.classList.remove("aspect-video"),line.nextElementSibling.remove(),$query("#printer").addEventListener("click",()=>{$query("#chart-viewer").src=line.toDataURL(),$query("neo-printer").print()});let c=[["",...s.keys],[$trans("Payments"),...s.payments],[$trans("Creances"),...s.creances],[$trans("Charges"),...s.charges],].map(e=>e.map(e=>{var t;return(t="number"==typeof e?$money(e):e)?(t=String(t).replace(/"/g,'""'),/[",\n]/.test(t)&&(t=`"${t}"`),t):'""'}).join(",")).join("\n");$query("#download").href=URL.createObjectURL(new Blob([c],{type:"text/csv"})),window.addEventListener("resize",o),$query("#trigger").addEventListener("click",e=>{setTimeout(()=>o(),250)})}async function SceneInitializer({Line:e,Search:t,Data:a}){t.forEach(([e,t,a,n])=>{TableVisualizer($query(e),t,{Search:a,Filter:n})});let n=await getData(a);function r(){e.style.width="100%",e.style.height="100%"}n.keys=n.keys.map(e=>$trans(e)),new Chart(line,{type:"bar",data:{labels:n.keys,datasets:[{data:n.payments,order:2,borderWidth:2,backgroundColor:"#22C55E",borderColor:"#22C55E",label:$trans("Payments")},{data:n.creances,order:2,borderWidth:2,backgroundColor:"#EAB308",borderColor:"#EAB308",label:$trans("Creances")},...n.charges?[{data:n.charges,borderWidth:2,backgroundColor:"#EC4899",borderColor:"#EC4899",label:$trans("Charges")}]:[],]},options:{responsive:!0,plugins:{legend:{labels:{fontColor:"#1D1D1D",fontSize:18}}}}}),line.parentElement.classList.remove("aspect-video"),line.nextElementSibling.remove(),$query("#printer").addEventListener("click",()=>{$query("#chart-viewer").src=line.toDataURL(),$query("neo-printer").print()});let l=[["",...n.keys],[$trans("Payments"),...n.payments],[$trans("Creances"),...n.creances],...n.charges?[[$trans("Charges"),...n.charges]]:[],].map(e=>e.map(e=>{var t;return(t="number"==typeof e?$money(e):e)?(t=String(t).replace(/"/g,'""'),/[",\n]/.test(t)&&(t=`"${t}"`),t):'""'}).join(",")).join("\n");$query("#download").href=URL.createObjectURL(new Blob([l],{type:"text/csv"})),window.addEventListener("resize",r),$query("#trigger").addEventListener("click",e=>{setTimeout(()=>r(),250)})}async function CalendarInitializer({Calendar:e,Data:t}){let a=await getData(t);var n=new FullCalendar.Calendar(e,{headerToolbar:{left:"title",right:"today,dayGridMonth,timeGridWeek,timeGridDay prev,next"},initialView:"dayGridMonth",firstDay:1,timeZone:"Africa/Casablanc",locale:document.documentElement.lang,events:a,locale:Locale});n.render(),e.nextElementSibling.remove(),$query(".fc-prev-button").innerHTML='<svg class="block w-6 h-6 pointer-events-none" fill="currentColor" viewBox="0 -960 960 960"><path d="M528-251 331-449q-7-6-10.5-14t-3.5-18q0-9 3.5-17.5T331-513l198-199q13-12 32-12t33 12q13 13 12.5 33T593-646L428-481l166 166q13 13 13 32t-13 32q-14 13-33.5 13T528-251Z"></path></svg>',$query(".fc-next-button").innerHTML='<svg class="block w-6 h-6 pointer-events-none" fill="currentColor" viewBox="0 -960 960 960"><path d="M344-251q-14-15-14-33.5t14-31.5l164-165-165-166q-14-12-13.5-32t14.5-33q13-14 31.5-13.5T407-712l199 199q6 6 10 14.5t4 17.5q0 10-4 18t-10 14L408-251q-13 13-32 12.5T344-251Z"></path></svg>',$query(".tools").appendChild($query(".fc-header-toolbar")),window.addEventListener("resize",()=>n.render()),$query("#trigger").addEventListener("click",e=>{setTimeout(()=>n.render(),250)})}function StateInitializer(e){let t=$query("neo-select[name=damage]"),a=$qall(".path"),n=$query("#parts"),r=$query("#state"),l=$query("#add"),i=document.createElement("table"),s=JSON.parse(r.value);var o=[];function c(e,t){i.innerHTML=`<tr class="border-t border-t-x-shade"><td class="ps-8 p-4 text-lg text-x-black"><div class="flex items-center gap-2 flex-wrap"><span class="block w-10 h-6 rounded-x-thin" style="background:${t}"></span><span class="block">${$cap($trans(e))}</span></div></td><td class="w-[80px] pe-8 p-4 text-base text-x-black text-center"><button class="block mx-auto px-2 py-1 bg-red-500 rounded-x-thin text-x-white outline-none hover:bg-red-400 focus:bg-red-400"><svg class="w-[1.2rem] h-[1.2rem] pointer-events-none" fill="currentColor" viewBox="0 -960 960 960"><path d="M267-74q-55.73 0-95.86-39.44Q131-152.88 131-210v-501H68v-136h268v-66h287v66h269v136h-63v501q0 57.12-39.44 96.56Q750.13-74 693-74H267Zm67-205h113v-363H334v363Zm180 0h113v-363H514v363Z" /></svg></button></td></tr>`;let a=i.querySelector("tr");return a.querySelector("button").addEventListener("click",e=>{e.preventDefault();let t=[...n.children].indexOf(a);s[t].parts.forEach(e=>{let t=$query("#"+e);t.classList.remove("selected"),t.style.fill=""}),s.splice(t,1),r.value=JSON.stringify(s),a.remove()}),a}l.addEventListener("click",a=>{if(!o.length||!t.value)return;let l=s.find(e=>e.type===t.value),i=l||{type:t.value,parts:[]};o.forEach(a=>{a.classList.remove("active"),a.classList.add("selected"),a.style.fill=e[t.value],i.parts.push(a.id)}),s.push(i),r.value=JSON.stringify(s),l||n.insertAdjacentElement("beforeend",c(t.value,e[t.value])),t.reset(),o=[]}),a.forEach(e=>{e.addEventListener("click",t=>{e.classList.contains("selected")||(e.classList.contains("active")?(o=o.filter(t=>t.id!==e.id),e.classList.remove("active"),e.style.fill=""):(e.classList.add("active"),e.style.fill="#458cfe80",o.push(e)))})}),s.length&&s.forEach(t=>{t.parts.forEach(a=>{let n=$query("#"+a);n.classList.add("selected"),n.style.fill=e[t.type]}),n.insertAdjacentElement("beforeend",c(t.type,e[t.type]))})}function StateScene({Colors:e,Data:t}){let a=$query("#img");function n(){setTimeout(()=>{printer.print()},250)}trigger=$query("#printer"),printer=$query("neo-printer"),trigger.addEventListener("click",()=>printer.print()),t.length&&t.forEach(t=>{t.parts.forEach(a=>{let n=$qall("#"+a);n.forEach(a=>{a.style.fill=e[t.type]})})}),a.complete&&n(),a.addEventListener("load",n)}const form=$query("form[require]");form&&form.addEventListener("submit",e=>{e.preventDefault();let t=form.querySelectorAll("[require]"),a=[];if(t.forEach(e=>{String(e.value).trim()?e.classList.remove("outline","outline-2","-outline-offset-2","outline-red-400"):e.classList.add("outline","outline-2","-outline-offset-2","outline-red-400"),a.push(!!String(e.value).trim())}),!a.includes(!1)){let n=$query("[data-tabs]");n&&n.classList.add("on"),form.submit()}});